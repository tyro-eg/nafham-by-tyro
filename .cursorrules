# Tyro Application - Cursor AI Rules

## ğŸ“‹ Project Overview
- **Stack**: React 18 + TypeScript 5.6 + Vite 5.4
- **State Management**: TanStack Query 5 (server state) + Redux Toolkit 2 (auth only)
- **Styling**: SCSS + Material-UI 6
- **Forms**: React Hook Form 7 + Zod 3
- **i18n**: react-i18next 15 (English/Arabic with RTL support)

---

## ğŸ¯ Core Principles

### 1. Type Safety First
- âœ… Use TypeScript strict mode
- âœ… NO `any` types unless absolutely necessary
- âœ… Define interfaces for all props, API responses, and complex types
- âœ… Use proper type imports (`import type` for type-only imports)

### 2. Server State with TanStack Query
- âœ… ALL server data fetching via TanStack Query hooks
- âœ… NO Redux for server state
- âœ… Use custom hooks in `src/hooks/`
- âœ… Centralized query keys in `src/lib/queryKeys.ts`

### 3. Code Consistency
- âœ… Follow existing patterns strictly
- âœ… Use Prettier (auto-format on save)
- âœ… Use ESLint (fix all warnings)
- âœ… Write JSDoc comments for exported functions/hooks

---

## ğŸ“ File Naming Conventions

### Components
```
âœ… kebab-case.component.tsx      (e.g., instructor-card.component.tsx)
âœ… kebab-case.styles.scss         (e.g., instructor-card.styles.scss)
âœ… index.component.tsx            (for module main files)
âŒ InstructorCard.tsx             (PascalCase - DON'T USE)
âŒ instructorCard.tsx             (camelCase - DON'T USE)
```

### Hooks
```
âœ… useXxxYyy.ts                   (e.g., useAuth.ts, useInstructors.ts)
âŒ authHook.ts                    (DON'T USE)
```

### Utilities
```
âœ… kebab-case.ts                  (e.g., api.ts, countries.ts)
âŒ apiUtils.ts                    (DON'T USE)
```

### Schemas
```
âœ… camelCaseSchemas.ts            (e.g., authSchemas.ts, userSchemas.ts)
```

### Styles
```
âœ… component-name.styles.scss     (preferred)
âœ… component-name.component.scss  (acceptable)
âœ… index.scss                     (for modules)
```

---

## ğŸ—ï¸ Component Structure

### Standard Component Template

```typescript
import { FC, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { Button } from '@mui/material';

import { useRtlClass } from '../../assets/utils/utils';

import './component-name.styles.scss';

interface ComponentNameProps {
  id: number;
  name: string;
  onAction?: () => void;
}

/**
 * ComponentName - Brief description
 * 
 * Detailed description of what this component does.
 * 
 * @example
 * <ComponentName id={1} name="Test" onAction={handleAction} />
 */
const ComponentName: FC<ComponentNameProps> = ({ id, name, onAction }) => {
  const { t } = useTranslation();
  const rtlClass = useRtlClass();
  const [isOpen, setIsOpen] = useState(false);

  const handleClick = () => {
    // Logic here
    onAction?.();
  };

  return (
    <div className={`component-name ${rtlClass}`}>
      <h2>{t('COMPONENT.TITLE')}</h2>
      <Button onClick={handleClick}>{t('COMPONENT.ACTION')}</Button>
    </div>
  );
};

export default ComponentName;
```

### Import Order (STRICT)
1. **React & React-related** (react, react hooks)
2. **Third-party libraries** (react-router, @mui, etc.)
3. **Internal hooks** (from `src/hooks/`)
4. **Internal utilities** (from `src/assets/utils/`)
5. **Components** (local and shared)
6. **Types** (from `src/assets/types.ts`)
7. **Styles** (ALWAYS LAST)

```typescript
// âœ… CORRECT ORDER
import { FC, useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button, Box } from '@mui/material';

import { useInstructors } from '../../hooks/useInstructors';
import { useRtlClass } from '../../assets/utils/utils';
import InstructorCard from '../instructor-card/instructor-card.component';
import { Instructor } from '../../assets/types';

import './component.styles.scss';

// âŒ WRONG - Mixed order
import './component.styles.scss';
import { Button } from '@mui/material';
import { FC } from 'react';
```

---

## ğŸª Custom Hooks Patterns

### Hook Template (TanStack Query)

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { get, post, patch, remove } from '../assets/utils/api';
import { queryKeys } from '../lib/queryKeys';
import { snackActions } from '../assets/utils/toaster';

/**
 * Fetch items with pagination
 */
export const useItems = (page: number = 1, size: number = 10) => {
  return useQuery({
    queryKey: queryKeys.items.list({ pageNumber: page, pageSize: size }),
    queryFn: async () => {
      const response = await get('/items', {
        params: { page_number: page, page_size: size },
      });
      return response.data.data;
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
  });
};

/**
 * Create new item
 */
export const useCreateItem = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (itemData: CreateItemData) => {
      const response = await post('/items', itemData);
      return response.data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.items.all() });
      snackActions.success('Item created successfully!');
    },
    onError: (error: any) => {
      snackActions.error(
        error.response?.data?.error || 'Failed to create item'
      );
    },
  });
};
```

### Key Hook Patterns
- âœ… Use `useQuery` for GET requests
- âœ… Use `useMutation` for POST/PUT/DELETE
- âœ… ALWAYS invalidate queries on mutation success
- âœ… Add error handling with `onError`
- âœ… Use centralized query keys from `queryKeys`
- âœ… Show user feedback with toaster

---

## ğŸ” Type Definitions

### Naming Conventions
```typescript
// âœ… API fields - snake_case (matches backend)
interface UserData {
  user_id: number;
  first_name: string;
  last_name: string;
  email_address: string;
  created_at: string;
}

// âœ… React props - PascalCase for interfaces
interface InstructorCardProps {
  instructor: Instructor;
  onBook: () => void;
}

// âœ… Form data types
export type LoginFormData = z.infer<typeof loginSchema>;

// âŒ DON'T mix snake_case and camelCase in same type
interface BadType {
  userId: number;        // camelCase
  first_name: string;    // snake_case - INCONSISTENT!
}
```

### Always Define Types For:
- Component props
- API request/response payloads
- Form data (infer from Zod schemas)
- Hook parameters
- Utility function parameters and returns

---

## ğŸ“ Zod Schema Patterns

### Schema Template

```typescript
import { z } from 'zod';
import i18n from '../component/i18next/i18n';

/**
 * Item Schema
 *
 * Validates item form data.
 *
 * Fields:
 * - name: Required, min 2 characters
 * - description: Optional, max 500 characters
 * - price: Required, positive number
 *
 * @example
 * const { register, handleSubmit } = useForm<ItemFormData>({
 *   resolver: zodResolver(itemSchema),
 * });
 */
export const itemSchema = z.object({
  name: z
    .string()
    .min(1, { message: i18n.t('GENEREL.REQUIRED') })
    .min(2, { message: 'Name must be at least 2 characters' }),
  description: z.string().max(500).optional(),
  price: z.number().positive({ message: 'Price must be positive' }),
});

export type ItemFormData = z.infer<typeof itemSchema>;
```

### Schema Patterns
- âœ… Use i18n for error messages
- âœ… Document all fields with JSDoc
- âœ… Export inferred types
- âœ… Use descriptive schema names (e.g., `createItemSchema`, `updateItemSchema`)
- âœ… Keep schemas in `src/schemas/` folder

---

## ğŸ¨ Styling Guidelines

### SCSS Structure
```scss
// âœ… BEM-like naming
.instructor-card {
  display: flex;
  padding: 1rem;

  &__header {
    font-size: 1.5rem;
    font-weight: bold;
  }

  &__content {
    margin-top: 1rem;
  }

  &--featured {
    border: 2px solid gold;
  }

  // RTL support
  &.rtl {
    direction: rtl;
    text-align: right;
  }
}

// âŒ DON'T use camelCase or random naming
.instructorCard {  // WRONG
  .header {}       // WRONG - too generic
}
```

### Material-UI + Custom Styles
```typescript
// âœ… Use className for custom styles
<Box className={`instructor-card ${rtlClass}`}>
  <Button className="instructor-card__button">
    Book Now
  </Button>
</Box>

// âœ… Use sx prop for one-off styles
<Box sx={{ padding: 2, marginTop: 1 }}>
  Content
</Box>

// âŒ DON'T use inline styles for complex styling
<div style={{ padding: '1rem', color: 'blue' }}> // AVOID
```

---

## ğŸŒ Internationalization (i18n)

### Usage Pattern
```typescript
import { useTranslation } from 'react-i18next';

const Component: FC = () => {
  const { t, i18n } = useTranslation();

  return (
    <div dir={i18n.dir()}>
      <h1>{t('HOME.WELCOME')}</h1>
      <p>{t('HOME.DESCRIPTION')}</p>
    </div>
  );
};
```

### Translation Keys Structure
```json
{
  "HOME": {
    "WELCOME": "Welcome to Tyro",
    "DESCRIPTION": "Learn English online"
  },
  "INSTRUCTOR": {
    "BOOK_NOW": "Book Now",
    "VIEW_PROFILE": "View Profile"
  },
  "GENEREL": {
    "REQUIRED": "This field is required",
    "INVALID_EMAIL": "Invalid email address"
  }
}
```

### i18n Rules
- âœ… ALWAYS use translation keys (never hardcoded strings)
- âœ… Use UPPERCASE for translation keys
- âœ… Group related translations in objects
- âœ… Add translations to BOTH `en/translation.json` AND `ar/translation.json`
- âœ… Use `useRtlClass()` hook for RTL support in components

---

## ğŸ”„ State Management

### When to Use What

#### TanStack Query (Server State)
```typescript
// âœ… Use for ALL server data
const { data: instructors, isLoading } = useInstructors(1, 10);
const createMutation = useCreateSession();
```

#### Redux (Client State - Auth ONLY)
```typescript
// âœ… ONLY for authentication
import { useAppSelector, useAppDispatch } from '../../redux/store';
import { selectCurrentUser } from '../../redux/user/user.selectors';
import { setCurrentUser } from '../../redux/user/user.slice';

const currentUser = useAppSelector(selectCurrentUser);
const dispatch = useAppDispatch();
```

#### Local State (UI State)
```typescript
// âœ… Use for component-specific UI state
const [isOpen, setIsOpen] = useState(false);
const [selectedTab, setSelectedTab] = useState(0);
```

### State Management Rules
- âŒ NEVER use Redux for server data (instructors, sessions, etc.)
- âŒ NEVER create new Redux slices
- âœ… Use TanStack Query for all API calls
- âœ… Use local state for UI toggles, modals, tabs, etc.

---

## ğŸš¨ Error Handling

### API Error Handling
```typescript
// âœ… In hooks
export const useCreateItem = () => {
  return useMutation({
    mutationFn: async (data: ItemData) => {
      const response = await post('/items', data);
      return response.data;
    },
    onSuccess: () => {
      snackActions.success('Item created!');
    },
    onError: (error: any) => {
      const message = error.response?.data?.error || 'Failed to create item';
      snackActions.error(message);
    },
  });
};

// âœ… In components
const createMutation = useCreateItem();

const handleSubmit = (data: ItemFormData) => {
  createMutation.mutate(data, {
    onSuccess: () => {
      navigate('/success');
    },
  });
};
```

### Form Validation Errors
```typescript
// âœ… React Hook Form handles validation errors
const {
  register,
  handleSubmit,
  formState: { errors },
} = useForm<FormData>({
  resolver: zodResolver(schema),
});

// Display errors
{errors.email && <span className="error">{errors.email.message}</span>}
```

---

## ğŸ“š Documentation Standards

### Component Documentation
```typescript
/**
 * InstructorCard Component
 * 
 * Displays instructor information with booking functionality.
 * Supports both trial and private session booking.
 * 
 * @param instructor - The instructor data object
 * @param onBook - Optional callback when booking is initiated
 * 
 * @example
 * <InstructorCard 
 *   instructor={instructor} 
 *   onBook={() => console.log('Booked!')} 
 * />
 */
const InstructorCard: FC<InstructorCardProps> = ({ instructor, onBook }) => {
  // ...
};
```

### Hook Documentation
```typescript
/**
 * useInstructors Hook
 * 
 * Fetches paginated list of instructors with TanStack Query.
 * Automatically caches results for 5 minutes.
 * 
 * @param pageNumber - Page number to fetch (default: 1)
 * @param pageSize - Number of items per page (default: 10)
 * @returns Query result with instructors data
 * 
 * @example
 * const { data, isLoading, error } = useInstructors(1, 10);
 */
export const useInstructors = (pageNumber: number, pageSize: number) => {
  // ...
};
```

### When to Add JSDoc
- âœ… ALL exported functions/hooks
- âœ… ALL component interfaces
- âœ… Complex utility functions
- âœ… Zod schemas
- âŒ Simple internal helper functions

---

## âš¡ Performance Best Practices

### Memoization
```typescript
// âœ… Memoize expensive calculations
const sortedItems = useMemo(() => {
  return items.sort((a, b) => a.name.localeCompare(b.name));
}, [items]);

// âœ… Memoize callbacks passed to children
const handleClick = useCallback(() => {
  doSomething(id);
}, [id]);

// âœ… Memoize heavy list components
const InstructorCard = memo(({ instructor }) => {
  return <div>{instructor.name}</div>;
});
```

### Query Configuration
```typescript
// âœ… Set appropriate stale times
useQuery({
  queryKey: queryKeys.instructors.list({ page: 1 }),
  queryFn: fetchInstructors,
  staleTime: 5 * 60 * 1000, // 5 minutes for lists
  // OR
  staleTime: 10 * 60 * 1000, // 10 minutes for rarely changing data
});
```

---

## ğŸš« Common Mistakes to Avoid

### âŒ DON'T DO THIS:

```typescript
// âŒ Using any types
const handleData = (data: any) => { ... }

// âŒ Redux for server state
const instructors = useAppSelector(selectInstructors);

// âŒ Hardcoded strings
<h1>Welcome to Tyro</h1>

// âŒ console.log in production code
console.log('Debug info:', data);

// âŒ Mixing import order
import './styles.scss';
import { FC } from 'react';

// âŒ Inline styles for complex styling
<div style={{ padding: '20px', backgroundColor: '#fff' }}>

// âŒ Not using centralized query keys
useQuery({ queryKey: ['instructors', page], ... })

// âŒ Direct API calls in components
const fetchData = async () => {
  const res = await axios.get('/api/data');
};
```

### âœ… DO THIS INSTEAD:

```typescript
// âœ… Proper types
interface DataPayload {
  id: number;
  name: string;
}
const handleData = (data: DataPayload) => { ... }

// âœ… TanStack Query for server state
const { data: instructors } = useInstructors(1, 10);

// âœ… i18n for all text
<h1>{t('HOME.WELCOME')}</h1>

// âœ… Remove debug logs or use proper logger
// (nothing in production)

// âœ… Correct import order
import { FC } from 'react';
import { Button } from '@mui/material';
import './styles.scss';

// âœ… SCSS classes
<div className="welcome-container">

// âœ… Centralized query keys
useQuery({ 
  queryKey: queryKeys.instructors.list({ pageNumber: page }), 
  ... 
})

// âœ… Custom hooks for API
const { data } = useInstructors();
```

---

## ğŸ§ª Testing Patterns (Future)

### Unit Test Template
```typescript
// component.test.tsx
import { render, screen } from '@testing-library/react';
import { InstructorCard } from './instructor-card.component';

describe('InstructorCard', () => {
  it('renders instructor name', () => {
    const instructor = { id: 1, name: 'John Doe' };
    render(<InstructorCard instructor={instructor} />);
    expect(screen.getByText('John Doe')).toBeInTheDocument();
  });
});
```

---

## ğŸ“¦ Adding New Features

### Checklist for New Features
1. âœ… Create TanStack Query hook in `src/hooks/`
2. âœ… Add query keys to `src/lib/queryKeys.ts`
3. âœ… Add Zod schema if form involved in `src/schemas/`
4. âœ… Create component in appropriate folder
5. âœ… Add corresponding SCSS file
6. âœ… Add translation keys to both EN and AR
7. âœ… Add JSDoc documentation
8. âœ… Test in both LTR and RTL modes
9. âœ… Run `npm run lint` to check for errors
10. âœ… Run `npm run format` to format code

---

## ğŸ”§ Utility Functions

### Common Utilities Location
- `src/assets/utils/api.ts` - API calls (get, post, patch, remove)
- `src/assets/utils/utils.ts` - General utilities (useRtlClass, etc.)
- `src/assets/utils/toaster.ts` - Notification utilities
- `src/assets/utils/countries.ts` - Country/nationality helpers
- `src/assets/utils/event.utils.ts` - Event transformation

### API Utility Usage
```typescript
import { get, post, patch, remove } from '../assets/utils/api';

// âœ… GET with params
const response = await get('/instructors', {
  params: { page: 1, size: 10 },
});

// âœ… POST with data
const response = await post('/sessions', sessionData);

// âœ… PATCH for updates
const response = await patch(`/users/${id}`, updateData);

// âœ… DELETE
const response = await remove(`/sessions/${id}`);
```

---

## ğŸ¯ Code Review Checklist

Before submitting code, ensure:
- [ ] No TypeScript errors (`npm run lint`)
- [ ] All files formatted (`npm run format`)
- [ ] Proper imports order
- [ ] JSDoc for exported functions
- [ ] Translation keys for all strings
- [ ] Proper type definitions (no `any`)
- [ ] TanStack Query for API calls
- [ ] Error handling in place
- [ ] Tested in both English and Arabic
- [ ] Follows file naming conventions
- [ ] SCSS follows BEM-like naming

---

## ğŸ“– Quick Reference

### File Structure
```
src/
â”œâ”€â”€ assets/          # Images, styles, types, utilities
â”œâ”€â”€ component/       # Shared components
â”œâ”€â”€ hooks/           # TanStack Query hooks (use* pattern)
â”œâ”€â”€ lib/             # Core utilities (queryClient, queryKeys, cn)
â”œâ”€â”€ modals/          # Modal components
â”œâ”€â”€ modules/         # Feature modules (pages)
â”œâ”€â”€ redux/           # Redux (auth only)
â”œâ”€â”€ schemas/         # Zod validation schemas
â”œâ”€â”€ App.tsx          # Main app component
â””â”€â”€ index.tsx        # App entry point
```

### Key Commands
```bash
npm run dev          # Start development server
npm run build        # Production build
npm run lint         # Check for errors
npm run format       # Format all files
```

### Key Libraries
- **React Router**: Navigation and routing
- **TanStack Query**: Server state management
- **React Hook Form**: Form handling
- **Zod**: Schema validation
- **Material-UI**: UI components
- **i18next**: Internationalization
- **Notistack**: Toast notifications

---

## ğŸš€ Remember

1. **Type Safety**: No `any` types
2. **TanStack Query**: All server state
3. **i18n**: All user-facing text
4. **Consistency**: Follow existing patterns
5. **Documentation**: JSDoc for exports
6. **Testing**: LTR and RTL modes
7. **Performance**: useMemo, useCallback where needed

---

**Last Updated**: October 31, 2025
**Status**: Production-Ready Conventions
**Maintained By**: Development Team

